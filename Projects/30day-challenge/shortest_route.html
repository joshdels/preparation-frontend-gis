<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map Circle Intersection</title>
    <script src="https://unpkg.com/maplibre-gl@^5.10.0/dist/maplibre-gl.js"></script>
    <link
      href="https://unpkg.com/maplibre-gl@^5.10.0/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      #map {
        width: 100%;
        height: 100%;
      }

    </style>
  </head>
  <body>
    <div id="map"></div>
<script>
function handleMap() {
  const map = new maplibregl.Map({
    container: "map",
    style: "https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",
    center: [121.034, 14.550],
    zoom: 14,
  });

  let start = [121.0154, 14.550];
  const end = [121.020, 14.560];
  const API = 'eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6IjAyYTQwNGRmZmZhZjQ1Yjc5M2UyYTJlOGQ4OWM5ZDNhIiwiaCI6Im11cm11cjY0In0='; // put your valid key in quotes

  // Function to fetch route and update map
  function drawRoute() {
    fetch(`https://api.openrouteservice.org/v2/directions/driving-car?api_key=${API}&start=${start[0]},${start[1]}&end=${end[0]},${end[1]}`)
      .then(res => res.json())
      .then(data => {
        const route = data.features[0].geometry;

        if (map.getSource('route')) {
          // If source exists, just update it
          map.getSource('route').setData({ type: 'Feature', geometry: route });
        } else {
          // First time: add source and layer
          map.addSource('route', {
            type: 'geojson',
            data: { type: 'Feature', geometry: route }
          });

          map.addLayer({
            id: 'route',
            type: 'line',
            source: 'route',
            layout: { 'line-join': 'round', 'line-cap': 'round' },
            paint: { 'line-color': '#ff0000', 'line-width': 4 }
          });
        }
      })
      .catch(err => console.error(err));
  }

  // Draw initial route
  map.on('load', () => {
    drawRoute();
  });

  // Update start point on click and redraw
  map.on('click', (e) => {
    start = [e.lngLat.lng, e.lngLat.lat];
    console.log(`New start: Longitude ${start[0]}, Latitude ${start[1]}`);
    drawRoute();
  });

  // Optional: show mouse coordinates in console
  /*map.on('mousemove', (e) => {
    const lngLat = e.lngLat;
    console.log(`Hover: Longitude ${lngLat.lng}, Latitude ${lngLat.lat}`);
  });
  */
}

handleMap();
</script>
</body>
</html>
